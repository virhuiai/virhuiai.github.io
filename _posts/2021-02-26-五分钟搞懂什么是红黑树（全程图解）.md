---
layout: post
title:  "五分钟搞懂什么是红黑树（全程图解） "
date:   2021-02-26 09:12:16 +0800
categories: 树
rname-cmd: mv ./_posts/a.md ./_posts/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.md
typora-root-url: ../
---

```
本文原文
https://www.toutiao.com/i6584714397543825927/
旋转的gif看：
https://www.toutiao.com/i6770830849999897102/
部分备注
```

# 前戏

红黑树，对很多童鞋来说，是既熟悉又陌生。

- Y: 熟悉是因为在校学习期间，准备面试时，这是重点。

- N:然后经过多年的荒废，如今已经忘记的差不多了。

如果正在看文章的你，马上快要毕业，面临着找工作的压力；又或者你觉得需要将这块知识重新复习一遍；又或者只是看看，那么恭喜你，赚到了。那么我将带领大家重新认识下红黑树，用简单的语言，搞懂红黑树。

在学习红黑树之前，咱们需要先来理解下二叉查找树（BST）。

# 二叉查找树

要想了解二叉查找树，我们首先看下二叉查找树有哪些特性呢？

1， 左子树上所有的节点的值均小于或等于他的根节点的值

2， 右子数上所有的节点的值均大于或等于他的根节点的值

3， 左右子树也一定分别为二叉排序树

> 二叉，叉，分开
>
> 左小于等于根
>
> 右大于等于根

我们来看下图的这棵树，他就是典型的二叉查找树

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/15331233881656de7d6ad5a.png)

那问题来了，`为什么`一定`要`这种结构呢？

换句话说这样的结构有什么`好处？`

## 查找的例子

我们就来查找下值为10的节点。它怎么一步步的找到这个节点的？步骤是怎样的？接着往下看。

1， 查找到根节点9，看下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/15331234072836ba5acf5f7.png)

2， 由于10大于9的，所以查找到右孩子13，看下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124295452bbaeb933d5.png)

3， 又因为10是小与13的，所以查找到左孩子11，看下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/15331243070327d140236cf.png)

4， 这一步相比不用说了大家也都知道了，找到了左孩子，然后发现正好是10 。恰好是正要寻找的值。

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124317544c7a7e9476f.png)

可能又有童鞋会问，这不是二分查找的思想吗？

确实，`查找所需的最大次数等同于二叉查找树的高度`。当然在插入节点的时候，也是这种思想，一层一层的找到合适的位置插入。

## 二叉查找树的缺陷

但是二叉查找树有个比较大的缺陷，而且这个缺陷会影响到他的性能。我们先来看下有一种情况的插入操作：

如果初始的二叉查找树只有三个节点，如下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124365512f2c80071d0.png)

我们依次插入5个节点：7，6,5,4,3,。看下图插入之后的图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124373478c59d11a5df.png)

看出来了吗？有没有觉得很别扭，如果根节点足够大，那是不是“左腿”会变的特别长，也就是说查找的性能大打折扣，几乎就是线性查找了。

那有没有好的办法解决这个问题呢？

解决这种多次`插入`新节点而导`致`的`不平衡`？这个时候红黑树就登场了。

# 红黑树-平衡的二叉查找树

红黑树就是一种平衡的二叉查找树，说他平衡的意思是他不会变成“瘸子”，左腿特别长或者右腿特别长。

## 红黑树的特性

除了符合二叉查找树的特性之外，还具体下列的特性：

```
1， 左子树上所有的节点的值均小于或等于他的根节点的值
2， 右子数上所有的节点的值均大于或等于他的根节点的值
3， 左右子树也一定分别为二叉排序树
```

4. 节点是红色或者黑色
5. 根节点是黑色
6. 每个叶子的节点都是黑色的空节点（NULL）【针对8用来计算的】
7. 每个红色节点的两个子节点都是黑色的。【红的子节点，可以是黑节点也可以是叶子节点NULL吧；黑色的节点的子节点颜色没有限制。】
8. 从任意节点到其每个叶子的所有路径都包含相同的黑色节点。

> 可以推出：插入的都是红色节点

看下图就是一个典型的红黑树：
![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124733745ba9036ca8c.png)​

条条框框有点多。

But，正是因为这些规则，才能保证红黑树的自平衡。最长路径不超过最短路径的2倍。

## 为什么要调整

当插入和删除节点，就会对平衡造成破坏，这时候需要对树进行调整，从而重新达到平衡。那什么情况下会破坏红黑树的规则呢？

1，我们看下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124733745ba9036ca8c.png)

向原来的红黑树插入值为14的新节点，

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/15331247538540d92640758.png)

由于父节点15是黑色节点，所以这种情况没有破坏结构，不需要做任何的改变。

2，向原树插入21呢？，看下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124733745ba9036ca8c.png)

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124766725ba5a13cbd7.png)

由于父节点22是红色节点，因此这种情况打破了红黑树的规则【每个红色节点的两个子节点都是黑色的。】，必须作出调整。那么究竟该怎么调整呢？

有两种方式【变色】和【旋转】（分为【左旋转】和【右旋转】）。

## 调整-变色

为了符合红黑树的规则，会把节点红变黑或者黑变红。下图展示的是红黑树的部分，需要注意节点25并非根节点，这儿只是显示讲到的部分。

因为21和22链接出现红色，不符合规则4【每个红色节点的两个子节点都是黑色的】，所以把22红变黑：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533124782865e5bc4cbda8.png)

但这样还是不符合规则5【从任意节点到其每个叶子的所有路径都包含相同的黑色节点。】，所以需要把25黑变红，看下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/153312479476656c5bcfdc1.png)

你以为现在结束了？天真，因为25和27又是两个连续的红色节点(规则4)，所以需要将27红变黑。

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533126337388d6eba883e3.png)

终于结束了，都满足规则了，舒服多了。

## 调整【左旋转】

也就是逆时针旋转两个节点，使父节点被自己的右孩子取代，而自己成为自己的左孩子，听起来吓死人，直接看图吧：

![我画了近百张图来理解红黑树](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/d4f615a27f474ebb821f0ab3a1c4c9b9.gif)

![image-20210226184229464](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/image-20210226184229464.png)

```
一共四个元素，
E
Less than E，作为左节点。
S
between E and S
gratter than S

1. ES两个旋转，左旋转，逆时针
S作为右节点，大于等于父节点E -->
S >= E  -->
S可以作为父节点，E作为左子节点
【S断开和between E and S的原因：不断开就三个子节点了】

2.E和 less than E 不变。

3.between E and S大于等于E   -->
E <= between E and S <= S   -->
可以断开和S的，作为E的右子节点。


4.S和gratter than S不变
```

```
旋转的看：
https://www.toutiao.com/i6770830849999897102/
```

## 调整【右旋转】

顺时针旋转两个节点，使得自己的父节点被左孩子取代，而自己成为自己的右孩子，看不懂直接看图吧：

```
旋转的看：
https://www.toutiao.com/i6770830849999897102/
```



![我画了近百张图来理解红黑树](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/5fa43e7602d04dfb9dd1c28345bbcfe6.gif)

![image-20210226184950112](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/image-20210226184950112.png)

```
一共四个元素，
E
Less than E，作为左节点。
S
between E and S
gratter than S

1. ES两个旋转，右旋转，顺时针
S作为右节点，大于等于父节点E -->
S >= E  -->
E可以作为父节点，S作为左子节点
【E断开和between E and S的原因：不断开就三个子节点了】

2.E和 less than E 不变。

3.between E and S小于等于S   -->
E <= between E and S <= S   -->
可以断开和E的，作为S的左子节点。

4.S和gratter than S不变
```

## 旋转的例子

看起来有点复杂，要怎么用呢？我们讲下典型的例子，大家参考下：

以刚才插入21节点的例子：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533126405821ca8d130456.png)

首先我们需要做的是变色，把节点25以及下方的节点变色：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/153312643006400dcd5c203.png)

由于17和25是连续的两个红色节点，那么将节点17变黑吗【4.每个红色节点的两个子节点都是黑色的。】？

但这样是不行的，17变黑后，右侧的就是3个黑深，左边2个，违反了【5. 从任意节点到其每个叶子的所有路径都包含相同的黑色节点。】

如果再把13变成红色，又违反了【2. 根节点是黑色】。

变色已经无法解决问题了，所以只能进行旋转了。13当成E，17当成S，左旋转试试看：

![我画了近百张图来理解红黑树](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/d4f615a27f474ebb821f0ab3a1c4c9b9.gif)

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533126485635ac0ed57fe8.png)![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/1533126670925bc8fec5925.png)
​

由于根节点必须是黑色，所以需要变色，结果如下图：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/15331266883082a58a02639.png)

继续，其中有两条路径（17-）8->6->NULL）的黑色节点个数不是3，是4不符合规则。

```
? TODO 这时如何确定是用旋转？要转哪个点？是否要变色的再走一回？
```

这个时候需要把13当做E，8当做S，进行右旋转：

![我画了近百张图来理解红黑树](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/5fa43e7602d04dfb9dd1c28345bbcfe6.gif)

最后根据规则变色：

![五分钟搞懂什么是红黑树（全程图解）](/assets/2021-02-26-五分钟搞懂什么是红黑树（全程图解）.assets/15331268807645f36af6932.png)

这样一来，我们终于结束了，经过调整之后符合规则。

那我们费这么大力气，这么复杂，这东西用在哪里，有哪些应用呢？

其实STL中的map就是用的红黑树。

# 总结：

红黑色的大体思想就是上面描述的那样，里面还有很多情况要考虑，本文只是简单的讲述思想，大家有兴趣可以去百度上看各种情况的考虑。谢谢大家的支持！